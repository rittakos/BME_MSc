<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.

const int priestCount = 5;
const int templeCount = 1;
const int ruinCount = 2;

// ids
typedef int[1, priestCount] pid_type;
typedef int[1, templeCount] tid_type;
typedef int[1, ruinCount] rid_type;

// channels wrong
//broadcast chan get;
//broadcast chan put;
//broadcast chan collect;

//channels fixed
chan get;
chan put;
chan collect;


// current state
int currentRelicCount = ruinCount;</declaration>
	<template>
		<name x="5" y="5">Temple</name>
		<parameter>tid_type tid</parameter>
		<declaration>// Place local declarations here.

const int maxRelicCount = 20;

// count of the relics in the temple, max 20
int relicCount = 0;

// demolish temple
void demolish(){
    currentRelicCount -= relicCount;
    relicCount = 0;
}


// add relic
void putRelic(){
    ++relicCount;
    ++currentRelicCount;
}

// get relic
void getRelic(){
    --relicCount;
    --currentRelicCount;
}</declaration>
		<location id="id0" x="-221" y="-136">
			<name x="-231" y="-170">Building</name>
		</location>
		<location id="id1" x="-17" y="-136">
			<name x="-68" y="-127">Normal</name>
		</location>
		<location id="id2" x="-17" y="85">
			<name x="-51" y="102">Demolished</name>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="guard" x="-85" y="-331">relicCount &lt; maxRelicCount</label>
			<label kind="synchronisation" x="-34" y="-314">put?</label>
			<label kind="assignment" x="-42" y="-272">putRelic()</label>
			<nail x="-85" y="-246"/>
			<nail x="-17" y="-289"/>
			<nail x="59" y="-246"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="guard" x="144" y="-161">relicCount &gt; 0</label>
			<label kind="synchronisation" x="144" y="-136">get?</label>
			<label kind="assignment" x="59" y="-144">getRelic()</label>
			<nail x="93" y="-221"/>
			<nail x="136" y="-127"/>
			<nail x="85" y="-51"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="assignment" x="-8" y="-25">demolish()</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
		</transition>
	</template>
	<template>
		<name>Priest</name>
		<parameter>pid_type pid</parameter>
		<declaration>int relicCount = 0;


// get relic from ruin
void collectRelic(){
    ++relicCount;   
    ++currentRelicCount; 
}

// put relic to temple
void putRelic(){
    --relicCount;   
    --currentRelicCount; 
}

// get relic from temple
void getRelic(){
    ++relicCount;    
    ++currentRelicCount;
}</declaration>
		<location id="id3" x="-1352" y="-927">
			<name x="-1394" y="-935">Idle</name>
		</location>
		<location id="id4" x="-1139" y="-1003">
			<name x="-1190" y="-1037">atRuin</name>
		</location>
		<location id="id5" x="-1139" y="-850">
			<name x="-1207" y="-842">atTemple</name>
		</location>
		<init ref="id3"/>
		<transition>
			<source ref="id5"/>
			<target ref="id5"/>
			<label kind="guard" x="-1037" y="-841">relicCount == 0</label>
			<label kind="synchronisation" x="-1045" y="-824">get!</label>
			<label kind="assignment" x="-1054" y="-807">getRelic()</label>
			<nail x="-1046" y="-833"/>
			<nail x="-1063" y="-791"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id5"/>
			<label kind="guard" x="-1054" y="-918">relicCount == 1</label>
			<label kind="synchronisation" x="-1045" y="-901">put!</label>
			<label kind="assignment" x="-1037" y="-884">putRelic()</label>
			<nail x="-1063" y="-901"/>
			<nail x="-1046" y="-859"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id4"/>
			<label kind="guard" x="-1028" y="-994">relicCount == 0</label>
			<label kind="synchronisation" x="-1028" y="-1028">collect!</label>
			<label kind="assignment" x="-1028" y="-1011">collectRelic()</label>
			<nail x="-1038" y="-1046"/>
			<nail x="-1038" y="-978"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id3"/>
			<nail x="-1267" y="-867"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<nail x="-1267" y="-1012"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id4"/>
			<nail x="-1088" y="-935"/>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id5"/>
			<nail x="-1139" y="-935"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id4"/>
		</transition>
	</template>
	<template>
		<name>Ruin</name>
		<parameter>rid_type rid</parameter>
		<declaration>// at start each ruin has one relic
int relicCount = 1;

// collect relic
void collectRelic(){
    relicCount = 0;
    --currentRelicCount;
}</declaration>
		<location id="id6" x="-212" y="-68">
			<name x="-222" y="-102">Full</name>
		</location>
		<location id="id7" x="0" y="-68">
			<name x="-17" y="-51">Empty</name>
		</location>
		<init ref="id6"/>
		<transition>
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="guard" x="-153" y="-126">relicCount == 1</label>
			<label kind="synchronisation" x="-153" y="-109">collect?</label>
			<label kind="assignment" x="-153" y="-93">collectRelic()</label>
		</transition>
	</template>
	<system>// Place template instantiations here.



// List one or more processes to be composed into a system.
system Temple, Priest, Ruin;</system>
	<queries>
		<query>
			<formula>E&lt;&gt; currentRelicCount &lt; 0</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; currentRelicCount &gt; ruinCount</formula>
			<comment></comment>
		</query>
	</queries>
</nta>
